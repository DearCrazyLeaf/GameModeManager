# GameModeManager
A Counter-Strike 2 server plugin inspired by the [CS2 Modded Dedicated Server by Kus](https://github.com/kus/cs2-modded-server) and the [CS2 Rock The Vote plugin by Abnerfs](https://github.com/abnerfs/cs2-rockthevote).

## Description
GameModeManager streamlines your Counter-Strike 2 server administration with these features:

- **RTV Compatibility:** Works seamlessly with your chosen RTV plugin, ensuring smooth rock-the-vote functionality.
- **Customizable Game Modes:** Easily define your server's game mode list and switch between them effortlessly using admin commands.
- **Dynamic Map Lists:** Automatically updates your maplist.txt file based on the current game mode or map group, eliminating manual map changes.

## Requirements
- Counter-Strike 2
- Metamod:Source v1282+
- Counter Strike Sharp v.197+

> [!NOTE]
> If you are using the [CS2 Modded Dedicated Server by Kus](https://github.com/kus/cs2-modded-server) you should remove the `Ultimate Map Chooser` plugin until the pull request is approved/finalized.

## Commands
- `css_mapgroup` - Sets the map group and updates the map list.
- `css_modes` - Displays an admin menu with game mode options.

  ![Screenshot 2024-03-21 161458](https://github.com/nickj609/GameModeManager/assets/32173425/db33fe48-21f3-455c-9987-5406fca99c4f)

- `css_maps` - Displays an admin menu with maps for the current game mode/map group.

  ![Screenshot 2024-03-21 161416](https://github.com/nickj609/GameModeManager/assets/32173425/f9c193b0-2ad3-4fa1-8a83-eaac812d2f21)

## RTV Plugin Compatibility

> [!IMPORTANT]
> You will need to set the `RTVEnabled` and `RTVPlugin` variables in the configuration file for RTV Plugin compatibility.

This plugin is compatible with any RTV plugin as long as it uses a maplist.txt file.

![Screenshot 2024-03-21 161846](https://github.com/nickj609/GameModeManager/assets/32173425/1e291efb-fe7f-4f0d-bb2c-e21d042bd153)

## Installation
1. Install Metamod:Source and Counter Strike Sharp.
2. Copy DLLs to `csgo/addons/counterstrikesharp/plugins/GameModeManager`.
3. Ensure your `gamemodes_server.txt` file contains a list of map groups.
4. Update your custom configuration files for each game mode to include `css_mapgroup <map group>`.

## Configuration
> [!IMPORTANT]
> On the first load, a configuration file will be created in `csgo/addons/counterstrikesharp/configs/plugins/GameModeManager/GameModeManager.json`.

GameModeManager offers flexible configuration options. See below for details and customization instructions.

| Config              | Description                                                                                                                               |
| ------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| MapGroup            | Sets the default map group on server start.                                                                                               | 
| MapGroupsFile       | Default path for the gamemodes_server.txt file used to specify game modes and map groups.                                                 | 
| MapListFile         | Default path for the maplist.txt file that needs to be updated when the map group or game mode changes.                                   | 
| DefaultMapFormat    | Sets the format for adding maps to the maplist.txt file to the default value `ws:{workshopid}`.                                           |
| RTVEnabled          | If set to enabled, the RTV plugin specified will be reloaded after updating the maplist.txt file.                                         | 
| RTVPlugin           | This is the default path to the RTV Plugin you are using. This can also just be the module name.                                          | 
| ListEnabled         | When enabled, the game mode list specified will be used. Otherwise, the list will be generated based on the map groups discovered.        |
| GameModeList        | Allows you to specify the list of game modes for your server.                                                                             |                                          

> [!NOTE]
> - All game mode configuration files must be located in the `csgo/cfg` directory.
> - All game mode configuration files must include `css_mapgroup` to set the current map group.
> - If `DefaultMapFormat` is set to `false`, the plugin will create the map list using the format `{mapname}:{workshopid}`.
> - If `ListEnabled` is set to `false`, the Game Mode List will be created based on the discovered map groups. For example, `mg_surf` would display as `surf` and the `surf.cfg` would be executed. 

#### Default Values

```
// This configuration was automatically generated by CounterStrikeSharp for plugin 'GameModeManager', at 2024/03/21 08:12:06
{
  "MapGroup": "mg_active",
  "MapGroupsFile": "/home/steam/cs2/game/csgo/gamemodes_server.txt",
  "MapListFile": "/home/steam/cs2/game/csgo/addons/counterstrikesharp/plugins/RockTheVote/maplist.txt",
  "DefaultMapFormat": true,
  "RTVEnabled": false,
  "RTVPlugin": "/home/steam/cs2/game/csgo/addons/counterstrikesharp/plugins/RockTheVote/RockTheVote.dll",
  "ListEnabled": true,
  "GameModeList": [
    "comp",
    "1v1",
    "aim",
    "awp",
    "scoutzknivez",
    "wingman",
    "gungame",
    "surf",
    "dm",
    "dm-multicfg",
    "course",
    "hns",
    "kz",
    "minigames"
  ],
  "ConfigVersion": 1
}
```

## Logging
>[!WARNING]
> Due to the heavy use of the above configuration file to specify paths to files and plugins, you may run into several issues upon the initial deployment. All logs associated with this plugin can be found in the below location.
> 
> `csgo/addons/counterstrikesharp/logs`

#### Example Log File
```
2024-03-30 16:52:58.352 +00:00 [INFO] plugin:GameModeManager Parsing map group file /home/steam/cs2/game/csgo/gamemodes_server.txt...
2024-03-30 16:52:58.366 +00:00 [INFO] plugin:GameModeManager Updating map list...
2024-03-30 16:52:58.366 +00:00 [INFO] plugin:GameModeManager Reloading RTV plugin...
2024-03-30 16:52:58.367 +00:00 [INFO] plugin:GameModeManager Updating map menu...
2024-03-30 16:53:16.367 +00:00 [INFO] plugin:GameModeManager Creating mode menu...
2024-03-30 16:53:32.320 +00:00 [INFO] plugin:GameModeManager OnModesCommand execution started
2024-03-30 16:53:36.472 +00:00 [INFO] plugin:GameModeManager OnMapsCommand execution started
2024-03-30 16:53:38.018 +00:00 [INFO] plugin:GameModeManager OnModesCommand execution started
2024-03-30 16:53:57.951 +00:00 [INFO] plugin:GameModeManager Map group command detected!
2024-03-30 16:53:57.952 +00:00 [INFO] plugin:GameModeManager Current MapGroup is mg_casual.
2024-03-30 16:53:57.952 +00:00 [INFO] plugin:GameModeManager New MapGroup is mg_dm.
2024-03-30 16:53:57.952 +00:00 [INFO] plugin:GameModeManager Updating map list...
2024-03-30 16:53:57.952 +00:00 [INFO] plugin:GameModeManager Reloading RTV plugin...
2024-03-30 16:53:57.953 +00:00 [INFO] plugin:GameModeManager Updating map menu...
```

